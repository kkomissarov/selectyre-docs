# Выгрузка ассортимента

Для получения выгрузки ассортимента, нужно сделать запрос методом `GET` по адресу:

`https://lk.selectyre.ru/export/json-assortment/`

Запрос принимает следующие параметры:

| Параметр | Обязательный | Описание         |
| :------- | :----------- | :--------------- |
| `uuid`   | Да           | Ключ авторизации |

Содержимое выгрузки формируется в соответствии с настройками складов в личном кабинете пользователя. 

Сформированная выгрузка ассортимента кэшируется для пользователя на 60 минут и повторно формируется при следующемуем обращении после истечения времени хранения кэша.

$~$
## Структура ответа

Ответ имеет формат `JSON` и состоит из следующих элементов:

| Элемент    | Описание                                         |
| :--------- | :----------------------------------------------- |
| `metainfo` | Мета-информация                                  |
| `tires`    | Список информации о товарах из категории "Шины"  |
| `wheels`   | Список информации о товарах из категории "Диски" |

$~$
<a name="metainfo"></a>

## Содержимое элемента metainfo

Элемент `metainfo` содержит общую вспомогательную информацию о выгрузке и об аккаунте пользователя. Элемент имеет следующую структуру:

| Элемент           | Тип данных | Описание                                           |
| :---------------- | :--------- | :------------------------------------------------- |
| `utc_update_time` | string     | Время формирования выгрузки в стандарте UTC        |
| `client_name`     | string     | Логин аккаунта, с которого была запрошена выгрузка |
| `license_expire`  | string     | Дата истечения лицензии                            |


$~$
## Содержимое элемента tires
Элемент `tires` - это список элементов с информацией о товарах из категории **Шины**. Каждый элемент списка имеет следующую структуру:

| Элемент                 | Тип данных | Описание                                                     |
| :---------------------- | :--------- | :----------------------------------------------------------- |
| `code`                  | string     | Код товара (может быть использован как идентификатор)        |
| `p_full_name`           | string     | Полное название товара                                       |
| `p_brand`               | string     | Название бренда                                              |
| `p_model`               | string     | Название модели                                              |
| `p_width`               | string     | Ширина шины                                                  |
| `p_height`              | string     | Профиль шины                                                 |
| `p_diameter`            | string     | Диаметр                                                      |
| `p_load_index`          | string     | Индекс нагрузки                                              |
| `p_speed_index`         | string     | Индекс скорости                                              |
| `p_season`              | string     | Сезон                                                        |
| `p_category`            | string     | Категория шины                                               |
| `p_xl`                  | boolean    | Усиленная (XL)                                               |
| `p_mud_terrain`         | boolean    | Грязевая                                                     |
| `p_all_terrain`         | boolean    | Универсальная                                                |
| `p_cargo`               | boolean    | Легкогрузовая                                                |
| `p_thorn`               | boolean    | Шипованная                                                   |
| `p_can_thorn`           | boolean    | Под ошиповку                                                 |
| `p_runflat`             | boolean    | Runflat                                                      |
| `p_protection`          | string     | Защита диска                                                 |
| `p_omologation`         | string     | Омологация                                                   |
| `p_side`                | string     | Надпись на боковине                                          |
| `p_axis`                | string     | Ось                                                          |
| `p_layering`            | integer    | Слойность                                                    |
| `p_appointment`         | string     | Назначение                                                   |
| `p_info_last_modified`  | string     | Время последнего обновления информации о товаре в стандарте UTC |
| `p_photo_last_modified` | string     | Время последнего обновления фото в стандарте UTC             |
| `p_photo`               | string     | Ссылка на фото товара с логотипом пользователя               |
| `p_shipping_weight`     | string     | Масса одной единицы товара (в кг)                            |
| `p_shipping_volume`     | string     | Объем одной единицы товара (в м³)                            |
| `p_shipping_length`     | string     | Длина одной единицы товара (в см)                            |
| `p_shipping_width`      | string     | Ширина одной единицы товара (в см)                           |
| `p_shipping_height`     | string     | Высота одной единицы товара (в см)                           |

$~$
Пример элемента из списка tires:
```json
    {
      "code": "t340076",
      "p_full_name": "Toyo Observe Garit GIZ 245/50 R18 100Q FR * OWL  PR30 Передняя Автобусная",
      "p_brand": "Toyo",
      "p_model": "Observe Garit GIZ",
      "p_width": "245.00",
      "p_height": "50.00",
      "p_diameter": "18.00",
      "p_load_index": "100",
      "p_speed_index": "Q",
      "p_season": "Зимняя",
      "p_category": "Легковая",
      "p_xl": false,
      "p_mud_terrain": false,
      "p_all_terrain": false,
      "p_cargo": false,
      "p_thorn": false,
      "p_can_thorn": false,
      "p_runflat": false,
      "p_protection": "FR",
      "p_omologation": "*",
      "p_side": "OWL",
      "p_axis": "Передняя",
      "p_layering": 30,
      "p_appointment": "Автобусная",
      "p_photo_last_modified": "2021-06-27T14:33:55.354Z",
      "p_info_last_modified": "2021-06-27T14:33:55.354Z",
      "p_photo": "https://lk.selectyre.ru/photo-processor/get-photo/eyJ0eXAiOiJKV1QiLLJAbGcLOiJZUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJjb2RlIjoidDM0MDA3NiJ9.mb8gHHBpAvkJkZ_Z_pstgsEMloXw9eMToj06rJtkpzM/",
      "p_shipping_weight": "19.00",
      "p_shipping_volume": "0.20",
      "p_shipping_length": "54.00",
      "p_shipping_width": "54.00",
      "p_shipping_height": "21.59"
    }
```

> Обращаем ваше внимание, что параметр `code` у товара может иногда меняться. При этом товар со старым кодом исчезнет из выгрузки. Это происходит из-за периодической актуализации информации в базе данных с полным удалением товаров и перевыгрузкой обновленных данных от поставщиков. 
> {.is-warning}



$~$
## Содержимое элемента wheels
Элемент `wheels` - это список элементов с информацией о товарах из категории **Диски**. Каждый элемент списка имеет следующую структуру:
| Элемент                  | Тип данных | Описание                                                     |
| :----------------------- | :--------- | :----------------------------------------------------------- |
| `code`                   | string     | Код товара (может быть использован как идентификатор)        |
| `p_full_name`            | string     | Полное название товара                                       |
| `p_brand`                | string     | Название бренда                                              |
| `p_model`                | string     | Название модели                                              |
| `p_color`                | string     | Цвет диска                                                   |
| `p_human_readable_color` | string     | Цвет диска в человекочитаемом формате                        |
| `p_width`                | string     | Ширина диска                                                 |
| `p_diameter`             | string     | Диаметр диска                                                |
| `p_bolts_count`          | string     | Количество отверстий для крепежных болтов                    |
| `p_bolts_space`          | string     | Расстояние между отверстиями для крепежных болтов            |
| `p_pcd`                  | string     | PCD                                                          |
| `p_et`                   | string     | Вылет                                                        |
| `p_dia`                  | string     | Диаметр центрального отверстия                               |
| `p_type`                 | string     | Материал диска (штампованный, литой и т.п.)                  |
| `p_photo_last_modified`  | string     | Время последнего обновления фото в стандарте UTC             |
| `p_info_last_modified`   | string     | Время последнего обновления информации о товаре в стандарте UTC |
| `p_category`             | string     | Категория диска                                              |
| `p_photo`                | string     | Ссылка на фото товара с логотипом пользователя               |
| `p_shipping_weight`      | string     | Масса одной единицы товара (в кг)                            |
| `p_shipping_volume`      | string     | Объем одной единицы товара (в м³)                            |
| `p_shipping_length`      | string     | Длина одной единицы товара (в см)                            |
| `p_shipping_width`       | string     | Ширина одной единицы товара (в см)                           |
| `p_shipping_height`      | string     | Высота одной единицы товара (в см)                           |

$~$
Пример элемента из списка wheels

```json
{
      "code": "w378709",
      "p_full_name": "Fondmetal STC-10 8x19 5*114.3 ET40 DIA75.1 Литой",
      "p_brand": "Fondmetal",
      "p_model": "STC-10",
      "p_color": "Matt titanium",
      "p_human_readable_color": "Серебристый",
      "p_width": "8.00",
      "p_diameter": "19.00",
      "p_bolts_count": 5,
      "p_bolts_space": "114.3",
      "p_pcd": "5x114.3",
      "p_et": "40.00",
      "p_dia": "75.10",
      "p_type": "Литой",
      "p_category": "Легковой",
      "p_photo_last_modified": "2020-06-27T14:33:56.396Z",
      "p_info_last_modified": "2021-06-27T14:33:55.354Z",
      "p_photo": "https://lk.selectyre.ru/photo-processor/get-photo/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjpxLCJjb2RlIjoidzM3ODcwOSJ9.bUJF5KyuWyx1BqFnVisys6WlRgsJLMBCLy3btRHWPKg/",
      "p_shipping_weight": "19.00",
      "p_shipping_volume": "0.20",
      "p_shipping_length": "54.00",
      "p_shipping_width": "54.00",
      "p_shipping_height": "21.59"
    }
```

$~$
## Получение фото с логотипом пользователя
Для получения фото с логотипом клиента необходимо выполнить запрос методом `GET` по адресу:

`https://lk.selectyre.ru/photo-processor/get-photo/<token>/`

`<token>` - это JWT-токен с зашифрованной информацией о товаре и пользователе.

**В теле ответа** вернется изображение в формате `png`.

Обязательное условие получения ответа - предоставить администраторам сервиса логотип в формате `png` или `jpg`. Без добавления логотипа, запрос будет возвращать ответ 404. 

В случае если в сервисе нет фотографии данного товара, запрос также вернет ответ 404. 


$~$
> Внимание! Наложение логотипа на фотографию происходит в момент обращения. Поэтому обработка большого количества запросов занимает продолжительное время и существенно увеличивает нагрузку на сервер. Большая просьба к разработчикам - не выгружать фотографии повторно без необходимости. Понять изменилась ли фотография с момента последней загрузки можно по дате модификации в информации о каждом товаре.  
> {.is-warning}

$~$
# Выгрузка остатков

Для получения выгрузки остатков, нужно сделать запрос методом `GET` по адресу:

`https://lk.selectyre.ru/export/json-availability/`

Запрос принимает следующие параметры:

| Параметр | Обязательный | Описание         |
| :------- | :----------- | :--------------- |
| `uuid`   | Да           | Ключ авторизации |

Содержимое выгрузки формируется в соответствии с настройками выгрузки остатков в личном кабинете пользователя.

Сформированная выгрузка остатков кэшируется для пользователя на 15 минут и повторно формируется при следующемуем обращении после истечения времени хранения кэша.


$~$
## Структура ответа

Ответ имеет формат `JSON` и состоит из следующих элементов:

| Элемент    | Описание                                            |
| :--------- | :-------------------------------------------------- |
| `metainfo` | Мета-информация                                     |
| `tires`    | Список предложений для товаров из категории "Шины"  |
| `wheels`   | Список предложений для товаров из категории "Диски" |


$~$
## Содержимое элемента metainfo
Идентично содержимому [элемента metainfo из выгрузки ассортимента](#metainfo). 

$~$
## Содержимое элементов tires и wheels
Элементы `tires` и `wheels` - это списки элементов, содержащих информацию о торговых предложениях соответствующего раздела. Каждый элемент списка имеет следующую структуру:

| Элемент                    | Тип данных | Описание                       |
| :------------------------- | :--------- | :----------------------------- |
| `code`                     | string     | Код товара                     |
| `year`                     | integer    | Год выпуска                    |
| `sale`                     | boolean    | Является ли товар уцененным    |
| `recommended_retail_price` | string     | Рекомендованная розничная цена |
| `minimal_internet_price`   | string     | Минимальная интернет-цена      |
| `stock_name`               | string     | Идентификатор склада           |
| `stock_name_ru`            | string     | Название склада                |
| `quantity`                 | integer    | Остаток                        |
| `wholesale_price`          | string     | Оптовая цена                   |
| `price`                    | string     | Розничная цена                 |
| `delivery_time`            | integer    | Время доставки (в днях)        |
| `provider_key`             | string     | Артикул поставщика             |
| `cae`                      | string     | Артикул производителя          |

$~$
Пример торгового предложения:
```json

    {
      "code": "t290300",
      "year": 2016,
      "sale": false,
      "recommended_retail_price": "12000.00",
      "minimal_internet_price": "11000.00",
      "stock_name": "yarshintorg_sankt-peterburg",
      "quantity": 20,
      "wholesale_price": "10406.00",
      "price": "11406.00",
      "delivery_time": 3,
      "provider_key": "123456",
      "cae": "TS120101"
    }
```

 > Внимание! Указание года и наличие пометки уцененного товара - не связанные напрямую параметры. Поставщик может не помечать устаревшие товары как уцененные, или не указывать год выпуска как причину уценки. 
 > {.is-warning}

$~$
# Выгрузка складов
Для получения выгрузки складов, нужно сделать запрос методом `GET` по адресу:

`https://lk.selectyre.ru/export/json-stocks/`

Ответ имеет формат `JSON` и состоит из следующих элементов:

| Элемент  | Описание                 |
| :------- | :----------------------- |
| `stocks` | Список доступных складов |

$~$
## Содержимое элементов списка stocks
Элементы списка `stocks` содержат информацию о складах. Каждый элемент списка имеет следующую структуру:

| Элемент      | Тип данных | Описание                         |
| :----------- | :--------- | :------------------------------- |
| `name`       | string     | Название склада                  |
| `phone`      | string     | Телефон                          |
| `site`       | string     | Сайт                             |
| `email`      | string     | Email                            |
| `address`    | string     | Адрес склада                     |
| `identifier` | string     | Идентификатор склада в выгрузках |

$~$
Пример склада:
```json
    {
      "name": "Шины оптом СПб",
      "phone": "8-812-000-00-00",
      "site": "https://shiny-optom-spb.com/",
      "email": "mail@shiny-optom-spb.com",
      "address": "ул. Ленина, дом 1",
      "identifier": "shiny_optom_spb"
    }
```